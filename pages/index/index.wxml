<view class="container">
  <view class="topbar">
    <image class="logo" src="/images/logo.png" mode="heightFix"></image>
    <text class="topbar-title">极客笔记</text>
  </view>
  <scroll-view class="chat-window" scroll-y="true" scroll-into-view="{{lastMessageId}}">
    <view wx:for="{{messages}}" wx:key="id" id="{{item.id}}" class="message-row {{item.type}} {{item.isLatest ? 'latest' : 'history'}}">
      <text class="prefix">[{{item.time}}] {{item.type == 'user' ? '用户' : '助手'}}# </text>
      <view class="content">
        <text wx:if="{{item.text}}">{{item.text}}</text>
        <image wx:if="{{item.image}}" src="{{item.image}}" mode="aspectFit" class="msg-image" bindtap="previewImage" data-src="{{item.image}}"></image>
        <view wx:if="{{item.file}}" class="file-box" bindtap="openFile" data-url="{{item.file}}">
          <text>FILE: {{item.fileName || 'ATTACHMENT'}}</text>
        </view>
      </view>
    </view>
    <view wx:if="{{isTyping}}" class="message-row system">
      <text class="prefix">助手# </text>
      <text class="cursor">_</text>
    </view>
  </scroll-view>

  <view class="action-bar">
    <view class="action-btn" bindtap="chooseImage">图片</view>
    <view class="action-btn" bindtap="chooseFile">文件</view>
    <view class="action-btn" bindtouchstart="startVoice" bindtouchend="stopVoice">语音</view>
  </view>

  <view class="input-area">
    <text class="input-prefix">></text>
    <input class="main-input" 
           value="{{inputValue}}" 
           bindinput="onInput" 
           bindconfirm="sendMessage" 
           placeholder="输入消息..." 
           placeholder-style="color: #004411;"
           confirm-type="send"
           focus="true"/>
  </view>
</view>
